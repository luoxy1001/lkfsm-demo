<!DOCTYPE html>
<html>
<head lang="zh-cn">
    <meta charset="UTF-8">
    <title>lkf-SmartCenter</title>
    <link rel="stylesheet" type="text/css" href="static/css/main.css">
</head>
<body>
<header class="haeder clearfix">
    <h1 class="haeder-h1"></h1>
    <ul class="header-nav">
        <li><a href="index.html">监控中心</a></li>
        <li><a href="index.html">商户管理</a></li>
        <li><a href="index.html">能源管理</a></li>
        <li><a href="index.html">角色管理</a></li>
    </ul>
    <div class="header-user">
        <a href="javascript:;" class="ic-user">Dave</a>
        <a href="javascript:;">退出</a>
    </div>
</header>
<section class="wrap">
    <div class="main-box clearfix">
        <div class="monitor-left">
            <div class="main-panel monitor-map">
                <h2 class="main-panel-title">区域地图事件</h2>
                <div class="monitor-map-img">
                    <canvas id="monitor-map-img"></canvas>
                </div>
                <div class="monitor-map-tools"></div>
                <div class="monitor-map-bm"></div>
                <div class="monitor-map-heat"></div>
            </div>
            <div class="clearfix mt-10">
                <div class="main-panel monitor-charts">
                    <h2 class="main-panel-title2"><span>昨日/今日客流量对比</span></h2>
                    <div class="monitor-charts-inner" id="echarts-1"></div>
                </div>
                <div class="main-panel monitor-charts ml-10">
                    <h2 class="main-panel-title2"><span>营业额/客流量对比</span></h2>
                </div>
            </div>
            <div class="clearfix mt-10">
                <div class="main-panel monitor-charts monitor-charts-1">
                    <h2 class="main-panel-title2"><span>车位数据信息</span></h2>
                </div>
                <div class="main-panel monitor-charts monitor-charts-2">
                    <h2 class="main-panel-title2"><span>当天停车饱和度峰值</span></h2>
                </div>
            </div>
        </div>
        <div class="monitor-right">
            <div class="main-panel monitor-video">
                <h2 class="main-panel-title">安防维护</h2>
            </div>
        </div>
    </div>
</section>
<script src="static/lib/jquery-3.2.1.min.js"></script>
<script src="static/lib/heatmap.js"></script>
<script src="static/lib/echarts.min.js"></script>
<script>
var map = {
    defult: {
        width: 1265,
        height: 1284,
        point: [0, 0],
        level: 0,
        src: 'static/images/map.png'
    },
    init: function(){
        var self = this, panel = $('#monitor-map-img'), wt = panel.width(), ht = panel.height(),
                ctx = panel[0].getContext('2d'),
                opts = self.defult;
        map.panel = panel;
        map.ctx = ctx;
        map.width = wt;
        map.height = ht;
        wt = opts.width;
        ht = opts.height;
        panel.attr('width', wt).attr('height', ht);
        ctx.fillStyle = '#00336c';
        ctx.fillRect(0, 0, wt, ht);
        var img = new Image();
        img.src = opts.src;
        img.onload = function(){
            self.loadmap(img);
        };
        self.dragg();
    },
    loadmap: function(img){
        var self = this, ctx = self.ctx;
        ctx.drawImage(img, 0, 0, 1265, 1284);
    },
    setMapLevel: function(lv){
        var self = this, panel = self.panel, lvar = [1, .9, .8, .7, .6, .5, .4, .3];
        lv = lvar[-lv];
        panel.css({'transform': 'scale(' + lv + ', ' + lv + ')'});
    },
    dragg: function(){
        var self = this,
            moveFlag = false, //区别moueseup与click的标志
            clickFlag  = false,
            $p = self.panel.parent();

        var maxLeft = self.panel.width() - $p.width() + 10,
            maxTop = self.panel.height() - $p.height() + 10;

        self.panel.on({
            mousedown: function(e){
                e.preventDefault();
                moveFlag = true;
                clickFlag = true;
                var $t = $(this), pos = $t.position();
                $t.data('mx', e.clientX);
                $t.data('my', e.clientY);
                $t.data('pos', pos);
            },
            mousemove: function(e){
                e.preventDefault();
                if(!moveFlag) return;
                var $t = $(this), mx = $t.data('mx'), my = $t.data('my'), pos = $t.data('pos');
                mx = e.clientX - mx;
                my = e.clientY - my;

                mx = pos.left + mx;
                my = pos.top + my;

                if(mx > 60) mx = 60;
                if(my > 30) my = 30;
                if(mx < -maxLeft) mx = -maxLeft;
                if(my < -maxTop) my = -maxTop;

                $t.css('left', mx + 'px');
                $t.css('top', my + 'px');

            },
            mouseup: function(e){
                e.preventDefault();
                moveFlag = false;
            },
            mouseout: function(){
                moveFlag = false;
            }
        });
    }
};

var main = {
    init: function(){
        map.init();
        main.chartsInit();
    },
    chartsInit: function(){
        // 初始化echarts实例
        var myChart = echarts.init($('#echarts-1')[0]);

        // 指定图表的配置项和数据
        var option = {
            title: {
                text: ''
            },
            textStyle: {
                color: '#00e6ff',
                fontSize: '12px'
            },
            /*tooltip : {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    label: {
                        backgroundColor: '#6a7985'
                    }
                }
            },*/
            legend: {
                data:[
                    {name: '今日', icon: 'rect', textStyle: {color: '#00e6ff'}},
                    {name: '昨日', icon: 'rect', textStyle: {color: '#00e6ff'}}
                ],
                orient: 'vertical',
                right: '0',
                itemWidth: 12,
                itemHeight: 8,
                itemGap: 0
            },
            toolbox: {
                /*feature: {
                    saveAsImage: {}
                }*/
            },
            grid: {
                show: true,
                left: '3%',
                right: '4%',
                bottom: '3%',
                borderWidth: 1,
                borderColor: '#0a3f78',
                containLabel: true
            },
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : false,
                    data : ['10','11','12','13','14','15','16','17','18','19','20','21','22','(hr)']
                }
            ],
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [
                {
                    name:'今日',
                    type:'line',
                    stack: '总量',
                    showSymbol: false,
                    /*label: {
                        normal: {
                            show: false,
                            position: 'right'
                        }
                    },*/
                    lineStyle: {
                        normal: {color: '#103f90', width:1}
                    },
                    areaStyle: {normal: {color: '#11378e'}},
                    data:[18000, 22000, 34000, 31000, 40000, 38000, 35000, 32000, 30000, 28000, 25000, 19000, 17000, 14000]
                },
                {
                    name:'昨日',
                    type:'line',
                    stack: '总量',
                    showSymbol: false,
                    areaStyle: {normal: {}},
                    data:[15000, 23000, 36000, 32000, 48000, 45000, 41000, 37000, 32000, 27000, 24000, 16000, 14000, 11000]
                }
            ]
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    }
};

$(function(){
    main.init();
});
</script>
</body>
</html>