<!DOCTYPE html>
<html>
<head lang="zh-cn">
    <meta charset="UTF-8">
    <title>lkf-SmartCenter</title>
    <link rel="stylesheet" type="text/css" href="static/css/main.css">
</head>
<body>
<header class="haeder clearfix">
    <h1 class="haeder-h1"></h1>
    <ul class="header-nav">
        <li><a href="supervisionCenter.html">监控中心</a></li>
        <li><a href="businessManage.html">商户管理</a></li>
        <li><a href="index.html">能源管理</a></li>
        <li><a href="index.html">角色管理</a></li>
    </ul>
    <div class="header-user">
        <a href="javascript:;" class="ic-user">Dave</a>
        <a href="javascript:;">退出</a>
    </div>
</header>
<section class="wrap">
    <div class="main-box clearfix">
        <div class="index-left">
            <div class="main-panel index-map">
                <h2 class="main-panel-title">区域地图事件</h2>
                <div class="index-map-img">
                    <canvas id="index-map-img">浏览器不支持canvas</canvas>
                    <div class="index-map-marks"></div>
                </div>
                <div class="index-map-tools">
                    <a class="index-map-tools-ic ic-eye" href="javascript:;" data-type="view"></a>
                    <a class="index-map-tools-ic ic-dl" href="javascript:;" data-type="diversion"></a>
                    <a class="index-map-tools-ic ic-ywgl" href="javascript:;" data-type="yunwei"></a>
                    <a class="index-map-tools-ic ic-zdy" href="javascript:;" data-type="customize"></a>
                    <a class="index-map-tools-ica ic-add" href="javascript:;"></a>
                    <a class="index-map-tools-ica ic-less" href="javascript:;"></a>
                </div>
                <div class="index-map-bl">1F/5层</div>
                <div class="index-map-bm">
                    <a href="javascript:;" class="ic-sxt"></a><a href="javascript:;" class="ic-ry"></a>
                </div>
                <div class="index-map-lt" id="map-lt">
                    <img src="static/images/map.png" style="display:none;"/>
                    <img src="static/images/map-ht.png"/>
                    <a href="javascript:;" class="index-map-qh ic-qh" id="map-qh"></a>
                </div>
            </div>
            <div class="clearfix mt-10">
                <div class="main-panel index-charts">
                    <h2 class="main-panel-title2"><span>昨日/今日客流量对比</span></h2>
                    <div class="index-charts-inner" id="echarts-1"></div>
                </div>
                <div class="main-panel index-charts ml-10">
                    <h2 class="main-panel-title2"><span>营业额/客流量对比</span></h2>
                    <div class="index-charts-inner" id="echarts-2"></div>
                </div>
            </div>
            <div class="clearfix mt-10">
                <div class="main-panel index-charts index-charts-1">
                    <h2 class="main-panel-title2"><span>车位数据信息</span></h2>
                    <div class="index-charts-inner"></div>
                </div>
                <div class="main-panel index-charts index-charts-2">
                    <h2 class="main-panel-title2"><span>当天停车饱和度峰值</span></h2>
                    <div class="index-charts-inner" id="echarts-3"></div>
                </div>
            </div>
        </div>
        <div class="index-right">
            <div class="main-panel index-video">
                <h2 class="main-panel-title">安防维护</h2>
            </div>
        </div>
    </div>
</section>

<!--dialog-->
<div class="mask" id="dl-mask"></div>
<div class="dialog dl-event" id="dl-events">
    <h3 class="dl-title"></h3>
    <a class="dl-close" href="javascript:;"></a>
    <div class="dl-content">
        <table class="tb-form">
            <tbody>
                <tr>
                    <th width="12%">日期</th>
                    <td width="35%">2017/03/05/21:00</td>
                    <th width="12%">地点</th>
                    <td width="34%">1F~B区 2~4 走廊</td>
                </tr>
                <tr>
                    <th>部门</th>
                    <td>
                        <select id="sel-bm">
                            <option value="1">运维部门人员1</option>
                            <option value="1">运维部门人员2</option>
                            <option value="1">运维部门人员3</option>
                            <option value="2">安保部门人员1</option>
                            <option value="2">安保部门人员2</option>
                            <option value="2">安保部门人员3</option>
                        </select>
                    </td>
                    <th>时间</th>
                    <td>
                        <select id="sel-sj">
                            <option value="0">立即执行</option>
                            <option value="12">12:00</option>
                            <option value="14">14:00</option>
                            <option value="16">16:00</option>
                            <option value="28">18:00</option>
                            <option value="20">20:00</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>备注</th>
                    <td colspan="3">
                        <textarea class="form-area" id="dl-area"></textarea>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="dl-footer">
        <a href="javascript:;" class="btn btn-dl" id="dl-save"></a>
    </div>
</div>

<script src="static/lib/jquery-3.2.1.min.js"></script>
<script src="static/lib/heatmap.js"></script>
<script src="static/lib/echarts.min.js"></script>
<script src="static/js/common/jquery.dropselect.js"></script>
<script src="static/js/common/jquery.smartmap.js"></script>
<script>

var main = {
    init: function(){
        //map.init();
        $('#index-map-img').smartmap();
        setTimeout(function(){
            var $mp = $('#index-map-img').data('smartmap');
            $.each(main.expdata.person, function(n, ite){
                $mp.addMark('person', 'person', ite.x, ite.y, ite.data);
            });
            $.each(main.expdata.camera, function(n, ite){
                $mp.addMark('camera', 'camera' + ite.status, ite.x, ite.y, {});
            });
        }, 10);
        main.chartsInit();
        main.uiBind();
    },
    chartsInit: function(){
        // 初始化echarts实例
        var myChart = echarts.init($('#echarts-1')[0]);

        // 指定图表的配置项和数据
        var option = {
            textStyle: {
                color: '#009bd2',
                fontSize: '12px'
            },
            legend: {
                data:[
                    {name: '今日', icon: 'rect', textStyle: {color: '#009bd2', fontSize: '10px'}},
                    {name: '昨日', icon: 'rect', textStyle: {color: '#009bd2', fontSize: '10px'}}
                ],
                orient: 'vertical',
                right: '0',
                itemWidth: 12,
                itemHeight: 8,
                itemGap: 2
            },
            grid: {
                show: true,
                left: '3%',
                right: '3%',
                bottom: '3%',
                top: '22%',
                borderWidth: 1,
                borderColor: '#145fac',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                data: ['10','11','12','13','14','15','16','17','18','19','20',"21","22","(hr)"],
                boundaryGap: false,
                splitLine: {
                    show: true,
                    interval: 'auto',
                    lineStyle: {
                        color: ['#145fac']//0a3f78
                    }
                },
                axisTick: {
                    show: false
                },
                axisLine: {
                    lineStyle: {color: '#215984'}//609ee9
                }
            },
            yAxis: {
                type: 'value',
                splitLine: {
                    lineStyle: {color: ['#145fac']}
                },
                axisLine: {
                    lineStyle: {color: '#009bd2'}
                }
            },
            series: [{
                name: '今日',
                type: 'line',
                smooth: true,
                showSymbol: false,
                symbol: 'circle',
                symbolSize: 6,
                lineStyle: {
                    normal: {color: '#7cb1e0', width:1}
                },
                areaStyle: {normal: {color: '#2751a3'}},
                data: ['1200', '1400', '1008', '1411', '1026', '1288', '1300', '800', '1100', '1000', '1118', '1322', '1122', '1002'],
                itemStyle: {
                    normal: {color: '#2751a3'}
                }
            }, {
                name: '昨日',
                type: 'line',
                smooth: true,
                showSymbol: false,
                symbol: 'circle',
                symbolSize: 6,
                data: ['1100', '1300', '808', '811', '626', '488', '1200', '600', '500', '300', '998', '822', '744', '600'],
                areaStyle: {
                    normal: {color: '#0e327f'}
                },
                itemStyle: {
                    normal: {color: '#0e327f'}
                },
                lineStyle: {
                    normal: {color: '#184fb3', width: 1}
                }
            }]
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);

        echarts.init($('#echarts-2')[0]).setOption({
            textStyle: {
                color: '#009bd2',
                fontSize: '12px'
            },
            legend: {
                data:[
                    {name: '增速', icon: 'rect', textStyle: {color: '#009bd2', fontSize: '10px'}},
                    {name: '销量', icon: 'rect', textStyle: {color: '#009bd2', fontSize: '10px'}}
                ],
                orient: 'vertical',
                right: '0',
                itemWidth: 12,
                itemHeight: 8,
                itemGap: 2
            },
            grid: {
                show: true,
                left: '3%',
                right: '3%',
                bottom: '3%',
                top: '22%',
                borderWidth: 1,
                borderColor: '#0a3f78',
                containLabel: true
            },
            xAxis: [{
                type: 'category',
                data: ['10','11','12','13','14','15','16','17','18','19','20',"21","22","(hr)"],
                boundaryGap: false,
                splitLine: {
                    show: true,
                    interval: 'auto',
                    lineStyle: {
                        color: ['#145fac']//0a3f78
                    }
                },
                axisTick: {
                    show: false,
                    alignWithLabel: true
                },
                axisLine: {
                    lineStyle: {color: '#215984'}//609ee9
                }
            }],
            yAxis: [{
                type: 'value',
                name: '(日万)',
                position: 'right',
                splitLine: {
                    show: false
                },
                axisLine: {
                    lineStyle: {color: '#009bd2'}
                }
            }, {
                type: 'value',
                name: '(人数/万)',
                position: 'left',
                splitLine: {
                    lineStyle: {color: ['#145fac']}
                },
                axisLine: {
                    lineStyle: {color: '#009bd2'}
                }
            }],
            series: [{
                name: '客流量',
                type: 'line',
                stack: '总量',
                lineStyle: {
                    normal: {color: '#7cb1e0', width:1}
                },
                z: 1,
                showSymbol: false,
                data: [1, 3, 2, 3, 3, 6, 8, 8, 9, 4, 6, 4, 2, 1]
            }, {
                name: '营业额',
                type: 'bar',
                yAxisIndex: 1,
                z: 2,
                stack: '总量',
                barWidth: 15,
                itemStyle: {
                    normal: {color: '#2751a3'}
                },
                data: [2, 4, 3, 5, 6, 8, 9, 6, 7, 5, 8, 5, 3, 1]
            }]
        });

        echarts.init($('#echarts-3')[0]).setOption({
            textStyle: {
                color: '#009bd2',
                fontSize: '12px'
            },
            legend: {
                show: false
            },
            grid: {
                show: true,
                left: '3%',
                right: '4%',
                bottom: '3%',
                top: '22%',
                borderWidth: 1,
                borderColor: '#145fac',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                data: ['00:00','03:00','06:00','09:00','12:00','15:00','18:00','21:00','24:00'],
                boundaryGap: false,
                splitLine: {
                    show: true,
                    interval: 'auto',
                    lineStyle: {
                        color: ['#145fac']//0a3f78
                    }
                },
                axisTick: {
                    show: false
                },
                axisLine: {
                    lineStyle: {color: '#215984'}//609ee9
                }
            },
            yAxis: {
                type: 'value',
                name: '(车位)',
                splitLine: {
                    lineStyle: {color: ['#145fac']}
                },
                axisLine: {
                    lineStyle: {color: '#009bd2'}
                }
            },
            series: [{
                name: '今日',
                type: 'line',
                smooth: true,
                showSymbol: false,
                symbol: 'circle',
                symbolSize: 6,
                lineStyle: {
                    normal: {color: '#7cb1e0', width:1}
                },
                areaStyle: {normal: {color: '#2751a3'}},
                data: ['12', '30', '40', '100', '180', '380', '300', '250', '80'],
                itemStyle: {
                    normal: {color: '#2751a3'}
                }
            }]
        });
    },
    dialog: function($t){
        $('#dl-mask').show();
        $t.show();
        $t.children('.dl-close').off().on('click', function(){
            main.dialogClose($t);
        });
    },
    dialogClose: function($t){
        $('#dl-mask').hide();
        $t.hide();
    },
    evdialog: function(ty){
        var $d = $('#dl-events'), obj = {
            'view': '<i class="dl-ic ic-dl-dl"></i>查看事件<strong class="ml-10 fw-b fc-white">VIEW</strong>',
            'diversion': '<i class="dl-ic ic-dl-dl"></i>导流事件<strong class="ml-10 fw-b fc-white">TRAFFIC GROOMING</strong>',
            'yunwei': '<i class="dl-ic ic-dl-dl"></i>运维事件<strong class="ml-10 fw-b fc-white">MAINTENANCE</strong>',
            'customize': '<i class="dl-ic ic-dl-dl"></i>自定义事件<strong class="ml-10 fw-b fc-white">CUSTOMIZE</strong>'
        };
        $d.children('.dl-title').html(obj[ty]);
        $('#dl-area').val('');
        main.dialog($d);
    },
    randm: function(ty){
        var len = 3, obj = {
            'view': [{name: '查看', status: '进行中'}, {name: '查看', status: '进行中'}, {name: '查看', status: '已结束'}],
            'diversion': [{name: '张三', status: '进行中'}, {name: '李四', status: '已结束'}, {name: '老王', status: '处理中'}],
            'yunwei': [{name: '安保A', status: '进行中'}, {name: '安保B', status: '已处理'}, {name: '安保C', status: '进行中'}],
            'customize': [{name: '查看', status: '进行中'}, {name: '查看', status: '进行中'}, {name: '查看', status: '已结束'}]
        };
        return obj[ty][Math.floor(Math.random()*len)];
    },
    expdata: {
        person: [
            {
                x: 340, y: 1106, data: {
                    info: {
                        content: "正在巡视……",
                        name: "安保A",
                        status: "进行中"
                    }
                }
            },
            {
                x: 290, y: 1100, data: {
                    info: {
                        content: "正在睡觉……",
                        name: "安保B",
                        status: "进行中"
                    }
                }
            },
            {
                x: 420, y: 1080, data: {
                    info: {
                        content: "正在聊天……",
                        name: "安保C",
                        status: "进行中"
                    }
                }
            }
        ],
        camera: [{x: 303, y: 1000, status: 'n'}, {x: 333, y: 1100, status: 'b'}, {x: 403, y: 1000, status: 'a'}, {x: 353, y: 1200, status: 'n'}, {x: 323, y: 1190, status: 'n'}]
    },
    uiBind: function(){
        $('#sel-bm, #sel-sj').dropselect();
        $('#dl-save').on('click', function(){
            var $bt = $('.index-map-tools-icsel'), map = $('#index-map-img').data('smartmap');
            if($bt.length === 0) return;
            var dt = $.extend(main.randm(map.evdata.ty), {content: $('#dl-area').val() || '事件为空'});
            map.addMark('events', map.evdata.ty, map.evdata.x, map.evdata.y, {info: dt});
            main.dialogClose($('#dl-events'));
        });
        $('#map-qh').on('click', function(){
            var map = $('#index-map-img').data('smartmap'), imgs = $('#map-lt > img');
            imgs.toggle();
            setTimeout(function(){
                map.loadmap(imgs.filter(':hidden')[0]);
            }, 0);
        });
    }
};

$(function(){
    main.init();
});
</script>
</body>
</html>